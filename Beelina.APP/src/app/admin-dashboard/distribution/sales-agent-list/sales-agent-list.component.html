<div class="panel panel--full-width sales-agent-container">
  <div class="panel__details-group-panel">
    <div class="panel__header-section">
      <label>{{
        "DASHBOARD_ADMIN.DISTRIBUTION_PAGE.SALES_AGENT_LIST_SECTION.TITLE"
        | translate
        }}</label>
      <span class="spacer"></span>
    </div>
    <div class="panel__body-section">

      @if(isLoading) {
      <!-- Loading skeleton cards -->
      <div *ngFor="let item of [1,2,3,4,5]; index as i" class="sales-agent-list__item-section loading"
        [style.animation-delay.ms]="i * 100">
        <div class="item-container">
          <div class="item-container__user-image">
            <div class="skeleton-circle"></div>
          </div>
          <div class="item-container__user-info">
            <div class="skeleton-line"></div>
            <div class="skeleton-line skeleton-line--small"></div>
          </div>
          <div class="skeleton-icon"></div>
        </div>
      </div>
      }

      @if(!isLoading) {
      <app-list-container [templateType]="emptyEntityTemplateEnum.CUSTOMERS" [count]="salesAgents?.length">
        <div class="list-container sales-agent-list" [class.initialized]="!isLoading">
          <!-- Actual sales agent cards -->
          <div *ngFor="let salesAgent of salesAgents; index as i; trackBy: trackById">
            <div matRipple [ngClass]="{
                  'sales-agent-list__item-section--active': salesAgent?.id === currentSalesAgent,
                  'transition-color-animation': salesAgent?.id === currentSalesAgent,
                  'moved': isMoved(salesAgent?.id),
                  'moved--up': isMoved(salesAgent?.id) && moveDir(salesAgent?.id) === 'up',
                  'moved--down': isMoved(salesAgent?.id) && moveDir(salesAgent?.id) === 'down'
                }" [style.animation-delay.ms]="isMoved(salesAgent?.id) ? i * 100 : 0"
              class="sales-agent-list__item-section list-container__item-section list-container__item-section--justify-content-space-between"
              (click)="selectSalesAgentEvent(salesAgent)" [attr.data-index]="i" [attr.data-rank]="i + 1">
              <div class="item-container">
                <div class="item-container__user-image-wrapper">
                  <!-- Medal badges for top 3 -->
                  @if(i === 0) {
                  <div class="medal-badge medal-gold" aria-label="1st place">
                    1
                  </div>
                  } @else if(i === 1) {
                  <div class="medal-badge medal-silver" aria-label="2nd place">
                    2
                  </div>
                  } @else if(i === 2) {
                  <div class="medal-badge medal-bronze" aria-label="3rd place">
                    3
                  </div>
                  }
                  <div class="item-container__user-image">
                    <img src="assets/icons/user-icon.png" alt="" loading="lazy" />
                  </div>
                </div>
                <div class="item-container__user-info">
                  <div class="item-container__user-name">{{ salesAgent.fullname }}</div>

                  <!-- Simplified Sales Target Information -->
                  <div class="item-container__target-info">
                    <span class="target-label">Target:</span>
                    <span class="target-value" [class.target-met]="isTargetMetForAgent(salesAgent.id)"
                      [class.target-overdue]="isTargetOverdueForAgent(salesAgent.id)">
                      {{ getFormattedTargetAmountForAgent(salesAgent.id) }}
                    </span>
                  </div>

                  <!-- Store counts display -->
                  <div class="item-container__store-counts">
                    <div class="store-count">
                      <span class="store-count__label">{{
                        'DASHBOARD_ADMIN.DISTRIBUTION_PAGE.SALES_AGENT_DETAILS_SECTION.SALES_INFORMATION_CONTAINER.STORES_WITH_ORDERS'
                        | translate }}:</span>
                      <span class="store-count__value store-count__value--clickable"
                        (click)="showStoresWithOrders(salesAgent.id, $event)" [attr.title]="'Click to view stores'">
                        {{ getStoresWithOrdersCount(salesAgent.id) }}
                      </span>
                    </div>
                    <div class="store-count">
                      <span class="store-count__label">{{
                        'DASHBOARD_ADMIN.DISTRIBUTION_PAGE.SALES_AGENT_DETAILS_SECTION.SALES_INFORMATION_CONTAINER.STORES_WITHOUT_ORDERS'
                        | translate }}:</span>
                      <span class="store-count__value store-count__value--clickable"
                        (click)="showStoresWithoutOrders(salesAgent.id, $event)" [attr.title]="'Click to view stores'">
                        {{ getStoresWithoutOrdersCount(salesAgent.id) }}
                      </span>
                    </div>
                  </div>
                </div>
                <div class="item-container__sales-info">
                  <div class="sales-amount">{{ getFormattedSalesAmountForAgent(salesAgent.id) }}</div>
                  <div class="completion-percentage" [ngClass]="getCompletionPercentageClass(salesAgent.id)">{{
                    getCompletionPercentageForAgent(salesAgent.id) }}%</div>
                </div>
                <mat-icon class="arrow-icon">keyboard_arrow_right</mat-icon>
              </div>
            </div>
          </div>
        </div>
      </app-list-container>
      }
    </div>
  </div>

</div>
