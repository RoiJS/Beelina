<div class="sales-information-container">
  <app-sales-chart-view [width]="800"></app-sales-chart-view>

  <div class="chart-filter-container">
    <div class="sales-date-filter-container">
      <div class="sales-date-filter-container__filter-options" [ngClass]="{
  'sales-date-filter-container__filter-options--active':
    currentFilterOption === 1
}" (click)="setFilterOption(1)">
        {{ "GENERAL_TEXTS.DAILY" | translate }}
      </div>
      <div class="sales-date-filter-container__filter-options" [ngClass]="{
  'sales-date-filter-container__filter-options--active':
    currentFilterOption === 2
}" (click)="setFilterOption(2)">
        {{ "GENERAL_TEXTS.WEEKLY" | translate }}
      </div>
      <div class="sales-date-filter-container__filter-options" [ngClass]="{
  'sales-date-filter-container__filter-options--active':
    currentFilterOption === 3
}" (click)="setFilterOption(3)">
        {{ "GENERAL_TEXTS.MONTHLY" | translate }}
      </div>
      <div class="sales-date-filter-container__filter-options" [ngClass]="{
  'sales-date-filter-container__filter-options--active':
    currentFilterOption === 4
}" (click)="setFilterOption(4)">
        {{ "GENERAL_TEXTS.CUSTOM" | translate }}
      </div>
    </div>

    <div class="sales-date-filter-options" [formGroup]="filterForm">

      @if (currentFilterOption === 1) {
      <div>
        <mat-form-field class="transaction-date" appearance="fill">
          <mat-label>{{
            "SALES_PAGE.FILTER_OPTIONS_PANEL.PICK_DATE" | translate
            }}:</mat-label>
          <input matInput (dateChange)="dateChange($event)" [matDatepicker]="picker" formControlName="day" />
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
      }

      @if (currentFilterOption === 2) {
      <div>
        <mat-form-field appearance="fill">
          <mat-label>{{
            "SALES_PAGE.FILTER_OPTIONS_PANEL.PICK_WEEK" | translate
            }}:</mat-label>
          <mat-select formControlName="week" (selectionChange)="weekChange($event)">
            @for (week of weekOptions; track $index) {
            <mat-option [value]="$index">{{ week }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      }

      @if (currentFilterOption === 3) {
      <div>
        <mat-form-field appearance="fill">
          <mat-label>{{
            "SALES_PAGE.FILTER_OPTIONS_PANEL.PICK_MONTH" | translate
            }}:</mat-label>
          <mat-select formControlName="month" (selectionChange)="monthChange($event)">
            @for (month of monthlyOptions; track $index) {
            <mat-option [value]="$index">{{ month }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      }

      @if (currentFilterOption === 4) {
      <div class="custom-date-range-container">
        <mat-form-field class="date-from-field" appearance="fill">
          <mat-label>{{
            "SALES_PAGE.FILTER_OPTIONS_PANEL.FROM_DATE" | translate
            }}:</mat-label>
          <input matInput (dateChange)="fromDateChange($event)" [matDatepicker]="fromPicker" formControlName="fromDate"
            [max]="maxDate" />
          <mat-datepicker-toggle matIconSuffix [for]="fromPicker"></mat-datepicker-toggle>
          <mat-datepicker #fromPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field class="date-to-field" appearance="fill">
          <mat-label>{{
            "SALES_PAGE.FILTER_OPTIONS_PANEL.TO_DATE" | translate
            }}:</mat-label>
          <input matInput (dateChange)="toDateChange($event)" [matDatepicker]="toPicker" formControlName="toDate"
            [min]="minToDate" [max]="maxDate" />
          <mat-datepicker-toggle matIconSuffix [for]="toPicker"></mat-datepicker-toggle>
          <mat-datepicker #toPicker></mat-datepicker>
        </mat-form-field>
      </div>
      }

    </div>
    <div class="panel panel--full-width sales-information-panel">
      <div class="panel-header">
        <div class="sales-amount-section">
          <div class="amount-container">
            <div class="amount-label">
              <mat-icon class="amount-icon">monetization_on</mat-icon>
              <label>{{ "SALES_PAGE.SALES_PANEL.LABEL" | translate }}</label>
            </div>
            @if (!isLoading) {
            <div class="amount-display">
              <span class="amount-value scale-in-center-animation">{{ sales }}</span>
              <div class="amount-actions">
                <button mat-icon-button class="details-button" (click)="openSalesBreakdownDialog()" 
                        matTooltip="View detailed sales breakdown">
                  <mat-icon>visibility</mat-icon>
                </button>
              </div>
            </div>
            } @else {
            <div class="amount-loading">
              <mat-spinner diameter="24"></mat-spinner>
            </div>
            }
          </div>
        </div>

        @if (currentSalesTargetProgress && !isLoading) {
        <div class="target-section">
          <div class="target-container">
            <div class="target-label">
              <mat-icon class="target-icon" [class.target-met]="isTargetMet()" [class.target-overdue]="isTargetOverdue()">
                {{ isTargetMet() ? 'check_circle' : isTargetOverdue() ? 'schedule' : 'track_changes' }}
              </mat-icon>
              <label>Sales Target</label>
            </div>
            <div class="target-display">
              <div class="target-amounts">
                <div class="target-amount-wrapper">
                  <span class="target-label-text">Target</span>
                  <span class="target-amount" [class.target-met]="isTargetMet()" [class.target-overdue]="isTargetOverdue()">
                    {{ getFormattedTargetAmount() }}
                  </span>
                </div>
                <div class="progress-wrapper">
                  <span class="progress-label-text">Progress</span>
                  <span class="progress-percentage" [class.target-met]="isTargetMet()" [class.target-overdue]="isTargetOverdue()">
                    {{ getCompletionPercentage() }}%
                  </span>
                </div>
              </div>
              <div class="target-actions">
                <button mat-icon-button class="details-button" (click)="openTargetDetailsDialog()" 
                        matTooltip="View detailed target information">
                  <mat-icon>visibility</mat-icon>
                </button>
              </div>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar" [style.width.%]="getCompletionPercentage()" 
                   [class.progress-met]="isTargetMet()" 
                   [class.progress-overdue]="isTargetOverdue()">
              </div>
            </div>
          </div>
        </div>
        } @else if (!isLoading) {
        <div class="no-target-section">
          <div class="no-target-container">
            <mat-icon class="no-target-icon">info_outline</mat-icon>
            <div class="no-target-content">
              <span class="no-target-title">No Active Target</span>
              <span class="no-target-text">Set a sales target to track progress</span>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>
