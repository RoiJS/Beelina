<app-tool-bar [title]="'DASHBOARD_ADMIN.HOME_PAGE.TITLE' | translate" [showBackButton]="false"></app-tool-bar>
<div class="page-container scale-in-center-animation">
  <div class="page-container__page-divider scale-in-center-animation">
    <label>{{ "DASHBOARD_ADMIN.HOME_PAGE.TITLE" | translate }}</label><br />
    <span class="page-information-description">{{
      "DASHBOARD_ADMIN.HOME_PAGE.DESCRIPTION" | translate
      }}</span>
  </div>
  <div class="sales-container">

    <div class="sales-container__chart-section">

      <div class="panel panel--full-width sales-container__panel sales-container__pie-chart-section">
        <div class="panel__header-section">
          {{ "DASHBOARD_ADMIN.HOME_PAGE.ORDER_TRANSACTION_DISTRIBUTION.TITLE" | translate }}
        </div>

        <div class="panel__body-section sales-container__body-section">
          @if (hideSalesAgentDistributionWidget()) {
          <app-subscription-panel></app-subscription-panel>
          }

          <app-loader-layout [busy]="salesPerAgentChartViewLoading">
            <div class="sales-per-agent-container">
              <app-sales-per-agent-view></app-sales-per-agent-view>
            </div>
          </app-loader-layout>
        </div>
      </div>

      <div class="panel panel--full-width sales-container__panel sales-container__bar-chart-section">
        <div class="panel__header-section">
          {{ 'DASHBOARD_ADMIN.HOME_PAGE.CHART_SECTION.TITLE' | translate }}
        </div>
        <div class="panel__body-section sales-container__body-section">
          <app-loader-layout [busy]="salesChartViewLoading">
            <app-sales-chart-view [width]="580"></app-sales-chart-view>
          </app-loader-layout>
        </div>
      </div>
    </div>


    <div class="sales-container__chart-filter-section">

      <div class="panel panel--full-width sales-container__panel sales-container__financial-summary-section">
        <div class="panel__header-section">
          {{ 'DASHBOARD_ADMIN.HOME_PAGE.CHART_SECTION.TITLE' | translate }}
        </div>
        <div class="panel__body-section sales-container__body-section">
          <div class="chart-filter-container">
            <div class="sales-date-filter-container">
              <div class="sales-date-filter-container__filter-options" [ngClass]="{
                'sales-date-filter-container__filter-options--active':
                  currentFilterOption === 1
              }" (click)="setFilterOption(1)">
                {{ "GENERAL_TEXTS.DAILY" | translate }}
              </div>
              <div class="sales-date-filter-container__filter-options" [ngClass]="{
                'sales-date-filter-container__filter-options--active':
                  currentFilterOption === 2
              }" (click)="setFilterOption(2)">
                {{ "GENERAL_TEXTS.WEEKLY" | translate }}
              </div>
              <div class="sales-date-filter-container__filter-options" [ngClass]="{
                'sales-date-filter-container__filter-options--active':
                  currentFilterOption === 3
              }" (click)="setFilterOption(3)">
                {{ "GENERAL_TEXTS.MONTHLY" | translate }}
              </div>
              <div class="sales-date-filter-container__filter-options" [ngClass]="{
                'sales-date-filter-container__filter-options--active':
                  currentFilterOption === 4
              }" (click)="setFilterOption(4)">
                {{ "GENERAL_TEXTS.CUSTOM" | translate }}
              </div>
            </div>

            <div class="sales-date-filter-options" [formGroup]="filterForm">

              @if (currentFilterOption === 1) {
              <div>
                <mat-form-field class="transaction-date" appearance="fill">
                  <mat-label>{{
                    "SALES_PAGE.FILTER_OPTIONS_PANEL.PICK_DATE" | translate
                    }}:</mat-label>
                  <input matInput (dateChange)="dateChange($event)" [matDatepicker]="picker" formControlName="day" />
                  <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
              </div>
              }

              @if (currentFilterOption === 2) {
              <div>
                <mat-form-field appearance="fill">
                  <mat-label>{{
                    "SALES_PAGE.FILTER_OPTIONS_PANEL.PICK_WEEK" | translate
                    }}:</mat-label>
                  <mat-select formControlName="week" (selectionChange)="weekChange($event)">
                    @for (week of weekOptions; track $index) {
                    <mat-option [value]="$index">{{ week }}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
              }

              @if(currentFilterOption === 3) {
              <div>
                <mat-form-field appearance="fill">
                  <mat-label>{{
                    "SALES_PAGE.FILTER_OPTIONS_PANEL.PICK_MONTH" | translate
                    }}:</mat-label>
                  <mat-select formControlName="month" (selectionChange)="monthChange($event)">
                    @for (month of monthlyOptions; track $index) {
                    <mat-option [value]="$index">{{ month }}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
              }

              @if (currentFilterOption === 4) {
              <div class="custom-date-range-container">
                <mat-form-field class="date-from-field" appearance="fill">
                  <mat-label>{{
                    "SALES_PAGE.FILTER_OPTIONS_PANEL.FROM_DATE" | translate
                    }}:</mat-label>
                  <input matInput (dateChange)="fromDateChange($event)" [matDatepicker]="fromPicker"
                    formControlName="fromDate" [max]="maxDate" />
                  <mat-datepicker-toggle matIconSuffix [for]="fromPicker"></mat-datepicker-toggle>
                  <mat-datepicker #fromPicker></mat-datepicker>
                </mat-form-field>

                <mat-form-field class="date-to-field" appearance="fill">
                  <mat-label>{{
                    "SALES_PAGE.FILTER_OPTIONS_PANEL.TO_DATE" | translate
                    }}:</mat-label>
                  <input matInput (dateChange)="toDateChange($event)" [matDatepicker]="toPicker"
                    formControlName="toDate" [min]="minToDate" />
                  <mat-datepicker-toggle matIconSuffix [for]="toPicker"></mat-datepicker-toggle>
                  <mat-datepicker #toPicker></mat-datepicker>
                </mat-form-field>
              </div>
              }

            </div>

            <div class="panel panel--full-width sales-information-panel">
              <div class="financial-summary-grid">
                <!-- Profit Section -->
                <div class="summary-card summary-card--profit">
                  <div class="summary-card__icon">
                    <mat-icon>trending_up</mat-icon>
                  </div>
                  <div class="summary-card__content">
                    <div class="summary-card__label">
                      {{ "DASHBOARD_ADMIN.HOME_PAGE.PROFIT_PANEL.LABEL" | translate }}
                    </div>
                    @if(!isLoading) {
                    <div class="summary-card__amount scale-in-center-animation">
                      {{ profit }}
                    </div>
                    } @else {
                    <div class="summary-card__loading">
                      <span class="loading-text">{{ "LOADER_LAYOUT.LOADING_TEXT" | translate }}</span>
                    </div>
                    }
                  </div>
                </div>

                <!-- Sales Section -->
                <div class="summary-card summary-card--sales">
                  <div class="summary-card__icon">
                    <mat-icon>payment</mat-icon>
                  </div>
                  <div class="summary-card__content">
                    <div class="summary-card__label">
                      {{ "SALES_PAGE.SALES_PANEL.LABEL" | translate }}
                    </div>
                    @if(!isLoading) {
                    <div class="summary-card__amount scale-in-center-animation">
                      {{ sales }}
                    </div>
                    } @else {
                    <div class="summary-card__loading">
                      <span class="loading-text">{{ "LOADER_LAYOUT.LOADING_TEXT" | translate }}</span>
                    </div>
                    }
                  </div>
                </div>
              </div>

              <div class="payment-breakdown-section">
                <div class="payment-breakdown-grid">
                  <div class="breakdown-item breakdown-item--delay-1">
                    <div class="breakdown-item__icon">
                      <mat-icon>payments</mat-icon>
                    </div>
                    <div class="breakdown-item__content">
                      <div class="breakdown-item__label">
                        {{ "SALES_PAGE.SALES_PANEL.CASH_ON_HAND_LABEL" | translate }}
                      </div>
                      <div class="breakdown-item__amount scale-in-center-animation">
                        {{ cashOnHand }}
                      </div>
                    </div>
                  </div>

                  <div class="breakdown-item breakdown-item--delay-2">
                    <div class="breakdown-item__icon">
                      <mat-icon>receipt</mat-icon>
                    </div>
                    <div class="breakdown-item__content">
                      <div class="breakdown-item__label">
                        {{ "SALES_PAGE.SALES_PANEL.CHEQUE_ON_HAND_LABEL" | translate }}
                      </div>
                      <div class="breakdown-item__amount scale-in-center-animation">
                        {{ chequeOnHand }}
                      </div>
                    </div>
                  </div>

                  <div class="breakdown-item breakdown-item--delay-3">
                    <div class="breakdown-item__icon">
                      <mat-icon>account_balance</mat-icon>
                    </div>
                    <div class="breakdown-item__content">
                      <div class="breakdown-item__label">
                        {{ "SALES_PAGE.SALES_PANEL.ACCOUNT_RECEIVABLES_LABEL" | translate }}
                      </div>
                      <div class="breakdown-item__amount scale-in-center-animation">
                        {{ accountReceivables }}
                      </div>
                    </div>
                  </div>

                  <div class="breakdown-item breakdown-item--warning breakdown-item--delay-4">
                    <div class="breakdown-item__icon">
                      <mat-icon>warning</mat-icon>
                    </div>
                    <div class="breakdown-item__content">
                      <div class="breakdown-item__label">
                        {{ "SALES_PAGE.SALES_PANEL.BAD_ORDERS_LABEL" | translate }}
                      </div>
                      <div class="breakdown-item__amount scale-in-center-animation">
                        {{ badOrders }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
